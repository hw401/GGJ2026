==========================================
文本选择黑色遮罩功能 - 详细使用说明
==========================================

【功能说明】
实现 TMP_InputField 中选中文本的黑色矩形遮罩效果（使用 UI Image 遮罩方案）。

【需要的文件】
1. TMPSelectionMaskUI.cs - UI 遮罩管理脚本（已创建）
2. TMPInputFieldSelector.cs - 文本选择检测脚本（已创建）

【使用步骤】

步骤 1：创建 TMP_InputField
----------------------------------------
1. 在 Unity 中，菜单：GameObject > UI > TextMeshPro > TextMeshPro - Input Field
2. 设置输入框的文本内容（在 Text 字段或通过代码设置）

步骤 2：添加脚本组件
----------------------------------------
在 TMP_InputField 所在的 GameObject 上添加以下两个脚本：

1. TMPSelectionMaskUI
   - 作用：创建和管理 UI Image 遮罩，实现黑色矩形遮罩效果
   - 位置：Inspector > Add Component > 搜索 "TMPSelectionMaskUI"

2. TMPInputFieldSelector
   - 作用：检测文本选择，调用遮罩组件
   - 位置：Inspector > Add Component > 搜索 "TMPInputFieldSelector"

步骤 3：配置 TMPSelectionMaskUI 组件
----------------------------------------
在 Inspector 中：

1. Input Field 字段：
   - 拖入场景中的 TMP_InputField 组件
   - 如果脚本挂在 InputField 上，会自动获取（可以为空）

2. Mask Color 字段：
   - 遮罩颜色，默认黑色（可以保持默认或修改）

3. Mask Parent 字段：
   - 遮罩的父对象（可选）
   - 如果不设置，会自动使用文本的父对象或 Canvas
   - 通常不需要手动设置

步骤 4：配置 TMPInputFieldSelector 组件
----------------------------------------
在 Inspector 中：

1. Input Field 字段：
   - 拖入场景中的 TMP_InputField 组件
   - 如果脚本挂在 InputField 上，会自动获取（可以为空）

2. Mask UI 字段：
   - 拖入同一个 GameObject 上的 TMPSelectionMaskUI 组件
   - 如果两个脚本在同一个 GameObject 上，会自动获取（可以为空）

【完整设置示例】
----------------------------------------
GameObject: "InputField" (或任意名称)
├── TMP_InputField (Unity 组件)
│   └── Text: "这是一段测试文本"
├── TMPSelectionMaskUI (脚本)
│   ├── Input Field: [自动获取或手动拖入]
│   ├── Mask Color: Black (默认)
│   └── Mask Parent: [自动获取，通常不需要设置]
└── TMPInputFieldSelector (脚本)
    ├── Input Field: [自动获取或手动拖入]
    └── Mask UI: [自动获取或手动拖入 TMPSelectionMaskUI]

【测试方法】
----------------------------------------
1. 运行游戏
2. 点击输入框使其获得焦点
3. 用鼠标拖拽选中文本
4. 选中的文本应该被黑色矩形遮罩覆盖
5. 控制台会打印选中的文字和遮罩信息

【常见问题排查】
----------------------------------------

问题 1：没有遮罩效果
- 检查 TMPSelectionMaskUI 组件是否正确添加
- 检查控制台是否有错误信息
- 检查 TMPInputFieldSelector 的 Mask UI 字段是否赋值
- 检查 Canvas 是否存在

问题 2：遮罩位置不对
- 检查遮罩的父对象是否正确（通常应该是文本的父对象）
- 查看控制台的坐标转换日志，检查坐标是否正确

问题 3：遮罩被文本遮挡
- 遮罩会自动设置层级在文本之上
- 如果还是被遮挡，检查 Canvas 的 Sort Order 或 Render Mode

问题 4：还是显示黄色高亮
- 确保没有 TMPTextHighlighter 组件（已删除）
- 检查输入框的 Selection Color 是否设置为透明

【代码逻辑说明】
----------------------------------------
1. TMPInputFieldSelector 每帧检查是否有文本被选中（使用 Update() 方法，兼容新版 Input System）
2. 当检测到选择时，调用 TMPSelectionMaskUI.UpdateSelectionMask()
3. TMPSelectionMaskUI 计算选中字符的边界框（在文本的局部坐标空间）
4. 将文本局部坐标转换为遮罩父对象的坐标空间
5. 创建或更新 UI Image 遮罩的位置和大小
6. 遮罩显示在文本上方，覆盖选中的文本

【注意事项】
----------------------------------------
- 代码已兼容 Unity 新版 Input System，不再依赖旧版 EventSystem 的指针事件接口
- 确保 Canvas 有 EventSystem（UI 交互需要，但代码不依赖 IPointerUpHandler）
- 确保 TMP_InputField 的 Read Only 设置为 false（如果需要选择功能）
- 遮罩会自动创建，不需要手动创建 UI Image
- 遮罩会在失去焦点时自动隐藏
